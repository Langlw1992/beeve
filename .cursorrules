# Cursor Rules for Beeve Project

You are an expert developer working on Beeve, a SolidJS-based low-code platform.

## üö® CRITICAL RULES - ZERO TOLERANCE FOR HALLUCINATION

```
1. NEVER guess APIs - query context7 for documentation first
2. NEVER assume library behavior without verification
3. NEVER confuse React patterns with Solid patterns
4. ALWAYS analyze existing code with serena before modifications
5. ALWAYS validate code with typecheck and lint
6. CHINESE RESPONSE: Reply in Simplified Chinese (except terms, code, commands)
7. VISUAL TESTING: Use chromeDevtools MCP for frontend visual inspection
8. SERVER CHECK: Before starting dev server, check if one is already running to avoid port conflicts
```

## MCP Requirements

- **context7**: MUST query before using ANY library API
- **serena**: MUST analyze code before ANY modifications
- **chromeDevtools**: MUST use for frontend visual testing and debugging

See `.ai/mcp-usage.md` for detailed requirements.

## Libraries Requiring Documentation Lookup

ALWAYS verify with context7 - NO EXCEPTIONS:
- solid-js, @tanstack/solid-*, tailwind-variants
- hono, drizzle-orm, zod
- vite, astro, biome

---

## Project Structure

```
beeve/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ web/          # SolidJS frontend (TanStack Router)
‚îÇ   ‚îú‚îÄ‚îÄ server/       # Hono API server
‚îÇ   ‚îî‚îÄ‚îÄ docs/         # Astro + Starlight documentation
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îú‚îÄ‚îÄ ui/           # @beeve/ui - Component library
‚îÇ   ‚îú‚îÄ‚îÄ lowcode-core/ # @beeve/lowcode-core - Low-code engine
‚îÇ   ‚îú‚îÄ‚îÄ auth-client/  # @beeve/auth-client - Auth SDK
‚îÇ   ‚îú‚îÄ‚îÄ db/           # @beeve/db - Drizzle + PostgreSQL
‚îÇ   ‚îú‚îÄ‚îÄ shared/       # @beeve/shared - Shared code
‚îÇ   ‚îî‚îÄ‚îÄ config/       # Shared configs
‚îî‚îÄ‚îÄ .ai/              # Detailed AI documentation
```

## Tech Stack

- **Frontend**: SolidJS, TanStack Router/Query/Form/Table, TailwindCSS v4
- **Backend**: Hono, PostgreSQL, Drizzle ORM, Zod
- **Build**: Vite, Turborepo, pnpm workspace
- **Lint/Format**: Biome (NOT ESLint/Prettier)

## Code Generation Rules

### SolidJS Components

```typescript
import { splitProps, type Component } from 'solid-js'
import { tv, type VariantProps } from 'tailwind-variants'

const componentVariants = tv({
  base: 'base-classes-here',
  variants: {
    variant: { primary: '...', secondary: '...' },
    size: { sm: '...', md: '...', lg: '...' },
  },
  defaultVariants: { variant: 'primary', size: 'md' },
})

export interface ComponentProps extends VariantProps<typeof componentVariants> {
  // additional props
}

export const Component: Component<ComponentProps> = (props) => {
  const [local, variants, rest] = splitProps(props, ['class', 'children'], ['variant', 'size'])
  return (
    <div class={componentVariants({ ...variants, class: local.class })} {...rest}>
      {local.children}
    </div>
  )
}
```

### API Routes (Hono)

```typescript
import { Hono } from 'hono'
import { zValidator } from '@hono/zod-validator'
import { z } from 'zod'

const schema = z.object({ field: z.string() })

const app = new Hono()

app.post('/', zValidator('json', schema), async (c) => {
  const body = c.req.valid('json')
  return c.json({ data: result })
})

export default app
```

### Database Schema (Drizzle)

```typescript
import { pgTable, uuid, varchar, timestamp } from 'drizzle-orm/pg-core'

export const tableName = pgTable('table_name', {
  id: uuid('id').primaryKey().defaultRandom(),
  field: varchar('field', { length: 255 }).notNull(),
  createdAt: timestamp('created_at').defaultNow().notNull(),
  updatedAt: timestamp('updated_at').defaultNow().notNull(),
})

export type Model = typeof tableName.$inferSelect
export type NewModel = typeof tableName.$inferInsert
```

## Strict Rules

1. **TypeScript**: Always use strict mode, never use `any`
2. **SolidJS**: Always use `splitProps`, never destructure props directly
3. **Styling**: Use `tailwind-variants` for all component variants
4. **Validation**: Use Zod for all input validation
5. **Exports**: Use named exports only, no default exports for components
6. **Linting**: Use Biome, not ESLint/Prettier
7. **Database**: Use UUID primary keys, snake_case for columns
8. **APIs**: NEVER guess - verify with context7 first
9. **No forEach**: Use `for...of` or array methods (`map`, `filter`, `reduce`) instead
10. **Braces Required**: Always use `{}` in if/else statements, even for single lines
11. **Use size-x**: When width and height are the same, use `size-x` instead of `w-x h-x`

## Anti-Hallucination Checklist

- [ ] API verified via context7?
- [ ] This is Solid, not React?
- [ ] Existing code analyzed with serena?
- [ ] All uncertainties marked?

## Response Format

```markdown
## Documentation Reference
[source]

## Implementation
[code]

## Verification
pnpm typecheck && pnpm lint

## ‚ö†Ô∏è Uncertainties
[if any]
```

## Response Format

```typescript
// Success
{ data: T, meta?: { page, pageSize, total } }

// Error  
{ error: { code: string, message: string, details?: object } }
```

## Naming

- Components: `PascalCase.tsx`
- Hooks: `use-kebab-case.ts`
- Utils: `kebab-case.ts`
- DB tables: `snake_case` (plural)
- DB columns: `snake_case`

## Import Order

1. External deps (solid-js, @tanstack/*)
2. Internal packages (@beeve/*)
3. Relative imports
4. Type imports

## Commands

```bash
pnpm dev        # Development
pnpm lint       # Lint with Biome
pnpm format     # Format with Biome
pnpm typecheck  # Type check
pnpm db:generate # Generate migrations
pnpm db:migrate  # Run migrations
```

## Reference

See `.ai/` for detailed documentation:
- `mcp-usage.md` - **MCP requirements (MUST READ)**
- `architecture.md`, `conventions.md`, `components.md`, `api.md`, `database.md`
