# Copilot Instructions for Beeve

## Build, Test, and Lint

This is a **pnpm monorepo** managed by Turborepo.

```bash
# From root
pnpm install              # Install all dependencies
pnpm build                # Build all packages (turbo)
pnpm lint                 # Lint all packages (turbo)
pnpm lint:fix             # Auto-fix lint issues
pnpm format               # Format with Biome
pnpm typecheck            # Type-check all packages

# UI library (packages/ui)
pnpm --filter @beeve/ui test           # Run tests in watch mode
pnpm --filter @beeve/ui test:run       # Run tests once
pnpm --filter @beeve/ui test:coverage  # Run tests with coverage (80% threshold)

# Run a single test file
pnpm --filter @beeve/ui vitest run src/components/Button/Button.test.tsx

# Dev servers
pnpm dev:web              # Web app + docs + storybook
pnpm dev:server           # Server only
```

## Architecture

**Monorepo structure:**

- `packages/ui` — SolidJS component library (`@beeve/ui`), built with tsup
- `apps/web` — Demo/showcase app using Vite + TanStack Router (file-based routing)
- `apps/storybook` — Storybook for component documentation
- `apps/ui-doc` — Astro Starlight documentation site

**UI library layering:** Headless primitives (Zag.js state machines) in `src/primitives/` → Styled components in `src/components/` → Exported via `src/index.ts`.

**Theming:** CSS custom properties generated by `src/themes/`, managed at runtime by `ThemeProvider` context. Theme persists to localStorage under key `beeve-theme`. Supports light/dark/system modes.

**Routing in web app:** TanStack Router v1 with `createFileRoute()`. Files in `apps/web/src/routes/` auto-generate `routeTree.gen.ts`. The `__root.tsx` layout provides a persistent sidebar with theme controls.

## Key Conventions

**Component file structure** — every component lives in its own directory:

```
ComponentName/
├── ComponentName.tsx          # Implementation
├── ComponentName.test.tsx     # Vitest + @solidjs/testing-library
├── ComponentName.stories.tsx  # Storybook story
├── index.ts                   # Re-exports
└── README.md                  # (optional) Component docs
```

**Styling** — Use `tv()` from `tailwind-variants` for component variant definitions. Tailwind CSS v4 via the `@tailwindcss/vite` plugin. No utility class strings scattered in logic — keep them in `tv()` definitions.

**SolidJS patterns:**
- Use `splitProps()` to separate component-specific props from pass-through HTML attributes
- Props interfaces use TypeScript; no `any` (enforced by Biome)
- Use `import type` for type-only imports (enforced by Biome: `useImportType`)

**Complex interactive components** use Zag.js state machines (e.g., Dialog, Select, Popover). The primitive layer in `src/primitives/` provides types and hooks; the component layer adds styling and composition.

**Formatting (Biome):** 2-space indent, single quotes, no semicolons, trailing commas, no bracket spacing. Files matching `*.gen.ts` are excluded from linting.

**Turbo `transit` task** — lint and typecheck tasks depend on `transit`, which is a pre-build step. This ensures generated files are up-to-date before checking.
