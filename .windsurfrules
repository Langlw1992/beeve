# Windsurf Rules for Beeve Project

## üö® CRITICAL RULES - MUST FOLLOW

```
1. ZERO HALLUCINATION: Never guess APIs - query context7 for documentation first
2. DOCUMENTATION FIRST: All library usage must have documented basis
3. CODE ANALYSIS: Use serena to understand existing code before modifications
4. VALIDATION: Code must pass typecheck and lint
5. TRANSPARENCY: State your sources, mark any uncertainties
6. SERVER CHECK: Before starting dev server, check if one is already running to avoid port conflicts
```

## MCP Requirements

- **context7**: MUST query docs before using ANY library API
  - **zag-js libraryId**: `/chakra-ui/zag` (use this ID directly, do NOT search)
- **serena**: MUST analyze code structure before modifications
- **chromeDevtools**: MUST use for frontend visual testing and debugging

See `.ai/mcp-usage.md` for detailed MCP usage requirements.

## Libraries Requiring Documentation Lookup (ALL)

NEVER guess - ALWAYS verify with context7:

### Frontend
- solid-js, @tanstack/solid-router, @tanstack/solid-query
- @tanstack/solid-form, @tanstack/solid-table, @tanstack/solid-virtual
- tailwindcss, tailwind-variants

### Backend
- hono, @hono/zod-validator, drizzle-orm, zod
### Build Tools
- vite, astro, @astrojs/starlight, typescript, biome

---

## Project Context

Beeve is a full-stack low-code platform with:
- SolidJS component library (@beeve/ui)
- Low-code engine (@beeve/lowcode-core)
- Hono API server (apps/server)
- UI documentation (apps/ui-doc)
- Component demos (apps/storybook)

## Tech Stack

Frontend: SolidJS, TanStack (Router/Query/Form/Table), TailwindCSS v4, Vite
Backend: Hono, PostgreSQL, Drizzle ORM, Zod
Tooling: pnpm workspace, Turborepo, Biome (linting/formatting)

## Design System & UI Rules

**Strictly adhere to the Beeve Design System (Compact Mode).**
Reference: `packages/ui/DESIGN_SYSTEM.md`

### 1. Sizing (Compact)
Use `tailwind-variants` (tv) with these exact specifications:

- **Default (md)**: `h-8` (32px), `text-sm` (14px), `px-3`
  - Usage: Standard inputs, buttons.
- **Small (sm)**: `h-7` (28px), `text-xs` (12px), `px-2`
  - Usage: Property panels, dense grids.
- **Large (lg)**: `h-9` (36px), `text-sm` (14px), `px-4`
  - Usage: Modal actions, primary calls-to-action.

### 2. Styling
- **Radius**: `rounded-md` (0.5rem/8px)
- **Colors**: Zinc (Neutral), Blue (Primary)
- **Focus Ring**: MUST use theme color `ring-primary/20` (not fixed colors).
- **Icons**: Use `lucide-solid` icons. Sizes: `size-3.5` (sm), `size-4` (md/lg).

### 3. Implementation Pattern
All components MUST support `ref` and `class` merging.

```typescript
import { splitProps, type Component, type ComponentProps } from 'solid-js'
import { tv, type VariantProps } from 'tailwind-variants'

const variants = tv({
  variants: {
    size: {
      default: "h-8 px-3 text-sm",
      sm: "h-7 px-2 text-xs",
      lg: "h-9 px-4 text-sm",
      icon: "h-8 w-8",
    },
  },
  defaultVariants: {
    size: "default",
  },
})

export interface MyComponentProps extends ComponentProps<'div'>, VariantProps<typeof variants> {
  // ...
}

export const MyComponent: Component<MyComponentProps> = (props) => {
  const [local, style, rest] = splitProps(props, ['class', 'children', 'ref'], ['size'])
  
  return (
    <div 
      ref={local.ref}
      class={variants({ ...style, class: local.class })} 
      {...rest}
    >
      {local.children}
    </div>
  )
}
```

## Critical Rules

### DO
- Use TypeScript strict mode everywhere
- Use Biome for linting and formatting (NOT ESLint/Prettier)
- Use `tailwind-variants` (tv) for component styling
- Use `splitProps` in SolidJS components
- Use Zod for all validation
- Use named exports
- Use UUID for primary keys
- Handle all errors in API routes
- Follow existing code patterns
- Use `for...of` or array methods (`map`, `filter`, `reduce`) for iteration
- Always use `{}` braces in if/else statements

### DON'T
- Don't use `any` type - use `unknown` with type guards
- Don't destructure reactive props in SolidJS
- Don't use ESLint or Prettier (use Biome)
- Don't use inline Tailwind classes for variants
- Don't create default exports for components
- Don't skip error handling
- Don't guess API signatures - verify with documentation first
- Don't assume library behavior without checking docs
- Don't use `forEach` - use `for...of` or functional methods instead
- Don't omit braces in if/else - always use `{}`
- Don't use `w-x h-x` when width equals height - use `size-x` instead

## Anti-Hallucination Checklist

Before writing code:
- [ ] Verified API exists in current version via context7?
- [ ] Checked correct parameters and return types?
- [ ] Confirmed this is Solid version, not React?
- [ ] Referenced existing project patterns?

## Response Format

```markdown
## Documentation Reference
- [source of API knowledge]

## Implementation
[code]

## Verification
pnpm typecheck && pnpm lint

## ‚ö†Ô∏è Uncertainties
- [anything needing human verification]
```

## Code Patterns

### SolidJS Component
```typescript
import { splitProps, type Component } from 'solid-js'
import { tv, type VariantProps } from 'tailwind-variants'

const variants = tv({
  base: 'base-classes',
  variants: { variant: { primary: '...', secondary: '...' } },
})

export interface Props extends VariantProps<typeof variants> {}

export const Component: Component<Props> = (props) => {
  const [local, variantProps, rest] = splitProps(props, ['class'], ['variant'])
  return <div class={variants({ ...variantProps, class: local.class })} {...rest} />
}
```

### Hono API Route
```typescript
import { Hono } from 'hono'
import { zValidator } from '@hono/zod-validator'
import { z } from 'zod'

const app = new Hono()
app.post('/', zValidator('json', schema), async (c) => {
  const body = c.req.valid('json')
  return c.json({ data: result })
})
```

### Drizzle Schema
```typescript
export const table = pgTable('table_name', {
  id: uuid('id').primaryKey().defaultRandom(),
  createdAt: timestamp('created_at').defaultNow(),
})
export type Model = typeof table.$inferSelect
```

## File Structure

```
beeve/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ web/          # SolidJS frontend
‚îÇ   ‚îú‚îÄ‚îÄ server/       # Hono API
‚îÇ   ‚îî‚îÄ‚îÄ docs/         # Astro + Starlight
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îú‚îÄ‚îÄ ui/           # Component library
‚îÇ   ‚îú‚îÄ‚îÄ lowcode-core/ # Low-code engine
‚îÇ   ‚îú‚îÄ‚îÄ auth-client/  # Auth SDK
‚îÇ   ‚îú‚îÄ‚îÄ db/           # Database layer
‚îÇ   ‚îî‚îÄ‚îÄ shared/       # Shared code
‚îî‚îÄ‚îÄ .ai/              # AI documentation
```

## Naming Conventions

- Components: PascalCase.tsx (Button.tsx)
- Hooks/utils: kebab-case.ts (use-auth.ts)
- DB tables: plural snake_case (users, oauth_accounts)
- DB columns: snake_case (created_at, password_hash)

## API Response Format

Success: { "data": T, "meta"?: {...} }
Error: { "error": { "code": "ERROR_CODE", "message": "..." } }

## Commands

pnpm dev - Start development
pnpm lint - Run Biome lint
pnpm format - Format code
pnpm typecheck - Type check
pnpm db:generate - Generate migrations
pnpm db:migrate - Run migrations

## Documentation

Detailed docs in .ai/ directory:
- mcp-usage.md - **MCP usage requirements (MUST READ)**
- architecture.md - System architecture
- conventions.md - Coding conventions
- components.md - Component guide
- api.md - API guide
- database.md - Database guide
- lowcode.md - Low-code engine
- workflow.md - AI workflow
