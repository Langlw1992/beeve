---
title: Presence 存在状态
description: 处理元素进入/退出动画的工具组件
---

import { PresenceBasic, PresenceWithAnimation, PresenceLazyMount, PresenceUnmountOnExit, PresenceOnExitComplete, PresenceRenderProps } from '../../../components/demos/PresenceDemo'

Presence 组件用于处理元素的进入/退出动画，确保退出动画完成后再卸载元素。基于 `@zag-js/presence` 实现。

## 基础用法

<PresenceBasic client:only="solid-js" />

```tsx
import { Presence, Button } from '@beeve/ui'
import { createSignal } from 'solid-js'

const [present, setPresent] = createSignal(true)

<Button onClick={() => setPresent(!present())}>
  {present() ? '隐藏' : '显示'}
</Button>
<Presence present={present()}>
  <div>这是一个受控显示的内容区域</div>
</Presence>
```

## 带动画效果

配合 Tailwind CSS 的动画类实现进入/退出效果。使用 `data-[state=open]` 和 `data-[state=closed]` 选择器。

<PresenceWithAnimation client:only="solid-js" />

```tsx
<Presence present={present()} unmountOnExit>
  <div
    class="transition-all duration-300 data-[state=open]:animate-in data-[state=open]:fade-in data-[state=open]:slide-in-from-top-2 data-[state=closed]:animate-out data-[state=closed]:fade-out data-[state=closed]:slide-out-to-top-2"
  >
    带有淡入淡出和滑动动画的内容
  </div>
</Presence>
```

## 懒加载

设置 `lazyMount` 后，元素只有在首次 `present=true` 时才会被挂载到 DOM。

<PresenceLazyMount client:only="solid-js" />

```tsx
<Presence present={present()} lazyMount>
  <div>这个内容只有在首次点击显示时才会被挂载到 DOM</div>
</Presence>
```

## 退出时卸载

设置 `unmountOnExit` 后，元素在退出动画完成后会从 DOM 中移除。

<PresenceUnmountOnExit client:only="solid-js" />

```tsx
<Presence present={present()} unmountOnExit>
  <div>隐藏后这个元素会从 DOM 中完全移除</div>
</Presence>
```

## 退出完成回调

通过 `onExitComplete` 监听退出动画完成事件。

<PresenceOnExitComplete client:only="solid-js" />

```tsx
<Presence
  present={present()}
  unmountOnExit
  onExitComplete={() => console.log('退出动画完成！')}
>
  <div class="transition-all duration-500 data-[state=closed]:animate-out data-[state=closed]:fade-out">
    隐藏时会触发 onExitComplete 回调
  </div>
</Presence>
```

## 渲染函数

通过函数形式的 children 可以获取当前的 presence 状态。

<PresenceRenderProps client:only="solid-js" />

```tsx
<Presence present={present()}>
  {({ isPresent }) => (
    <div>
      当前状态: {isPresent ? '显示中' : '隐藏中（动画进行中）'}
    </div>
  )}
</Presence>
```

## usePresence Hook

除了 Presence 组件，还可以直接使用 `usePresence` hook 获得更细粒度的控制。

```tsx
import { usePresence } from '@beeve/ui'

const presence = usePresence(() => ({
  present: isOpen(),
  lazyMount: true,
  unmountOnExit: true,
  onExitComplete: () => console.log('完成'),
}))

// 使用返回值
<Show when={!presence().unmounted}>
  <div
    ref={presence().setRef}
    {...presence().presenceProps}
  >
    内容
  </div>
</Show>
```

## API

### PresenceProps

| 属性 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `present` | `boolean` | - | 控制元素是否显示 |
| `lazyMount` | `boolean` | `false` | 是否懒加载（首次 present=true 时才挂载） |
| `unmountOnExit` | `boolean` | `false` | 退出动画完成后是否卸载元素 |
| `onExitComplete` | `() => void` | - | 退出动画完成时的回调 |
| `children` | `JSX.Element \| ((props: { isPresent: boolean }) => JSX.Element)` | - | 子元素或渲染函数 |

### UsePresenceReturn

| 属性 | 类型 | 说明 |
|------|------|------|
| `unmounted` | `boolean` | 元素是否应该被卸载 |
| `isPresent` | `boolean` | 元素是否处于显示状态 |
| `setRef` | `(node: HTMLElement \| null) => void` | 需要绑定到目标元素的 ref |
| `presenceProps` | `{ hidden: boolean; 'data-state': 'open' \| 'closed' }` | 需要绑定到目标元素的属性 |
